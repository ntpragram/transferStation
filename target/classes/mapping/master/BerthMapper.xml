<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ch.dao.master.BerthMapper">
  <resultMap id="BaseResultMap" type="com.ch.dataobject.master.Berth">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 20 16:39:04 CST 2019.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="berthTotalCapacity" jdbcType="DOUBLE" property="berthtotalcapacity" />
    <result column="berthUseCapacity" jdbcType="DOUBLE" property="berthusecapacity" />
    <result column="berthWaitNumber" jdbcType="INTEGER" property="berthwaitnumber" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="isWrite" jdbcType="INTEGER" property="iswrite" />
    <result column="isCar" jdbcType="INTEGER" property="iscar" />
    <result column="isStop" jdbcType="INTEGER" property="isstop" />
    <result column="createTime" jdbcType="TIMESTAMP" property="createtime" />
    <result column="isdel" jdbcType="INTEGER" property="isdel" />
    <result column="downspouting" jdbcType="INTEGER" property="downspouting" />
    <result column="onoff" jdbcType="INTEGER" property="onoff" />
    <result column="ip" jdbcType="VARCHAR" property="ip" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="lc" jdbcType="INTEGER" property="lc" />
    <result column="bm" jdbcType="INTEGER" property="bm" />
    <result column="content" jdbcType="VARCHAR" property="content" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Nov 20 16:39:04 CST 2019.
    -->
    id, berthTotalCapacity, berthUseCapacity, berthWaitNumber, status, isWrite, isCar, 
    isStop, createTime, isdel, downspouting, onoff,ip,type,lc,bm,content
  </sql>

  <select id="getBerthList" parameterType="com.ch.dataobject.master.Berth" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from berth
    where isdel=0 order by id asc
  </select>

  <select id="findById" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from berth
    where id = #{id}
  </select>


  <update id="updateStatus" parameterType="com.ch.dataobject.master.Berth">
    update berth set status = #{param2}
    where id = #{param1}
  </update>

  <update id="updateStatus1" parameterType="com.ch.dataobject.master.Berth">
    update berth set status = #{param2},berthUseCapacity = #{param3}
    where id = #{param1}
  </update>

  <insert id="addBerth" parameterType="com.ch.dataobject.master.Berth">
    insert into berth (berthTotalCapacity,berthUseCapacity,status)  values (#{param1},#{param1},#{param2})
  </insert>

  <insert id="addReplaceContainer" parameterType="com.ch.dataobject.master.Berth">
    insert into replace_container (berthId)  values (#{param1})
  </insert>

  <update id="updateBerthLoad" parameterType="com.ch.dataobject.master.Berth">
    update berth set berthTotalCapacity = #{param1}  where id = #{param2}
  </update>


  <select id="findBerth" parameterType="java.lang.Double" resultMap="BaseResultMap">
   select  id, berthTotalCapacity, berthUseCapacity, berthWaitNumber, status, isWrite, isCar,
    isStop, createTime, isdel, downspouting, onoff from berth
        where isdel=0 and berthWaitNumber=0 and  status=0 and berthTotalCapacity-berthUseCapacity > #{param1} and id not in(select berthNumber from stops_outbound where status=0 and to_days(inputTime) =to_days(now())) order by berthTotalCapacity-berthUseCapacity asc limit 1
  </select>

  <update id="updateBerthUseCap" parameterType="com.ch.dataobject.master.Berth">
    update berth set berthWaitNumber = 1,berthUseCapacity =berthUseCapacity + #{param2}  where id = #{param1}
  </update>

  <select id="findBerth1" parameterType="java.lang.Double" resultMap="BaseResultMap">
    select id,berthTotalCapacity,berthUseCapacity,berthWaitNumber,status, isWrite, isCar,
      isStop, createTime, isdel, downspouting, onoff from berth
        where isdel=0 and berthWaitNumber != 2 and status=0 and berthTotalCapacity-berthUseCapacity > #{param1}  order by berthTotalCapacity-berthUseCapacity asc limit 1
  </select>

  <update id="updateBerthUseCap1" parameterType="com.ch.dataobject.master.Berth">
    update berth set berthWaitNumber = 2,berthUseCapacity =berthUseCapacity + #{param2}  where id = #{param1}
  </update>

    <update id="updateDownspouting" parameterType="com.ch.dataobject.master.Berth">
        update berth set downspouting = #{param2}
        where id = #{param1}
  </update>

    <update id="updateOnoff" parameterType="com.ch.dataobject.master.Berth">
        update berth set onoff = #{param2}
        where id = #{param1}
  </update>

  <update id="updateType" parameterType="com.ch.dataobject.master.Berth">
        update berth set type =#{param2}
        where id = #{param1}
  </update>

  <select id="getBerthList1" parameterType="com.ch.dataobject.master.Berth" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from berth
     order by id asc
  </select>

  <update id="updateTypeOrContentAndStatus" parameterType="com.ch.dataobject.master.Berth">
        update berth set type =#{type},status=#{status},content=#{content},berthUseCapacity=0
        where id = #{berthId}
  </update>

  <update id="updateContent" parameterType="com.ch.dataobject.master.Berth">
        update berth set content=#{content}
        where id = #{berthId}
  </update>

  <update id="updateWaitNumber" parameterType="com.ch.dataobject.master.Berth">
        update berth set berthWaitNumber=berthWaitNumber-1
        where id = #{berthId}
  </update>

  <update id="updateBerthUseTotal" parameterType="com.ch.dataobject.master.Berth">
        update berth set berthUseCapacity =berthUseCapacity- #{cargoweight}
        where id = #{berthnumber}
  </update>

  <update id="updateBerthUseTotalAdd" parameterType="com.ch.dataobject.master.Berth">
        update berth set berthUseCapacity =berthUseCapacity+ #{cargoweight}
        where id = #{berthId}
  </update>

</mapper>